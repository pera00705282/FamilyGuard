apiVersion: 1

# List of directories from which to load alert rules
groups:
  - name: 'Crypto Trading Alerts'
    interval: 1m
    rules:
      # System Alerts
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100 > 90
        for: 5m
        labels:
          severity: 'warning'
          team: 'trading'
        annotations:
          summary: 'High CPU usage on {{ $labels.instance }}'
          description: 'CPU usage is {{ $value }}% for 5 minutes'

      - alert: HighMemoryUsage
        expr: 100 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100 > 90
        for: 5m
        labels:
          severity: 'warning'
          team: 'trading'
        annotations:
          summary: 'High memory usage on {{ $labels.instance }}'
          description: 'Memory usage is {{ $value }}% for 5 minutes'

      # Application Alerts
      - alert: HighErrorRate
        expr: rate(http_requests_total{status_code=~"5.."}[5m]) / rate(http_requests_total[5m]) * 100 > 5
        for: 5m
        labels:
          severity: 'critical'
          team: 'trading'
        annotations:
          summary: 'High error rate ({{ $value }}%) on {{ $labels.path }}'
          description: 'Error rate is above 5% for 5 minutes'

      - alert: HighLatency
        expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, path)) > 1
        for: 5m
        labels:
          severity: 'warning'
          team: 'trading'
        annotations:
          summary: 'High latency on {{ $labels.path }}'
          description: '95th percentile latency is {{ $value }}s'

      # Trading Alerts
      - alert: HighTradeErrorRate
        expr: rate(trading_trade_errors_total[5m]) / rate(trading_trades_executed_total[5m]) * 100 > 10
        for: 5m
        labels:
          severity: 'critical'
          team: 'trading'
        annotations:
          summary: 'High trade error rate ({{ $value }}%) on {{ $labels.exchange }} for {{ $labels.symbol }}'
          description: 'Trade error rate is above 10% for 5 minutes'

      - alert: HighDrawdown
        expr: trading_drawdown_percent > 10
        for: 15m
        labels:
          severity: 'warning'
          team: 'trading'
        annotations:
          summary: 'High drawdown detected ({{ $value }}%) for {{ $labels.symbol }}'
          description: 'Current drawdown is above 10% for 15 minutes'

      - alert: HighSlippage
        expr: histogram_quantile(0.95, rate(trading_slippage_percent_bucket[5m])) > 0.5
        for: 5m
        labels:
          severity: 'warning'
          team: 'trading'
        annotations:
          summary: 'High slippage detected ({{ $value }}%) for {{ $labels.symbol }}'
          description: '95th percentile slippage is above 0.5% for 5 minutes'
